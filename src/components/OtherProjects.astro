---
import { Image } from 'astro:assets';
import type { Lang } from '../i18n/config';
import { useTranslations } from '../i18n/utils';
import { getProjectsData } from '../data';

interface Props {
  lang: Lang;
}

const { lang } = Astro.props;
const t = useTranslations(lang);
const projects = getProjectsData(lang);

const hobbyProjects = projects.filter(project => project.category === 'hobby');

// 画像のインポート
const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/images/*.{jpeg,jpg,png,gif,webp}');

async function getImage(imageName: string) {
  const imagePath = `/src/assets/images/${imageName}`;
  const imageModule = images[imagePath];
  if (!imageModule) return null;
  return (await imageModule()).default;
}

// 各プロジェクトの画像を事前ロード
const hobbyProjectsWithImages = await Promise.all(
  hobbyProjects.map(async (project) => ({
    ...project,
    imageData: await getImage(project.image),
  }))
);
---

<div id="other-projects" class="w-full flex lg:flex-row flex-col px-4 md:px-8 lg:px-16">
  <div class="w-full text-center">
    <h2 class="text-3xl my-4 font-bold text-gray-900 leading-tight mb-2 border-t-4 border-b-4 border-gray-600 py-4">{t('projects.hobby.title')}</h2>
    <div class="grid lg:grid-cols-3 gap-4 grid-cols-1 md:grid-cols-2">
      {hobbyProjectsWithImages.map(project =>
        <div class="items-center p-3 text-base text-gray-900 rounded-lg bg-gray-50 group">
          {project.imageData ? (
            <Image
              src={project.imageData}
              alt={project.name}
              width={128}
              height={128}
              class="h-32 rounded-lg my-2 block m-auto"
              loading="lazy"
            />
          ) : (
            <img src={`/images/contents_images/${project.image}`} alt={project.name} class="h-32 rounded-lg my-2 block m-auto" />
          )}
          <h3 class="text-lg font-bold">{project.name}</h3>
          <div class="text-sm flex flex-row flex-wrap justify-center my-1">{
            project.tags.map(tag =>
            <span class="text-xs bg-gray-200 rounded-full px-2 mx-1">{tag}</span>
          )
          }</div>
          <div class="flex flex-col">
            <div class="flex-grow">
              <p class="text-sm">{ project.description }</p>
            </div>
            <div class="">
              {
                project.url.map(url =>
                  <a href={url.url
                    } class="text-blue-800 hover:underline mx-2" target="_blank" rel="noopener noreferrer">{url.name}</a>
                )
              }
            </div>
          </div>
        </div>
      )}
    </div>
  </div>
</div>
